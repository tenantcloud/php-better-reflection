<?php

declare (strict_types=1);
namespace TenantCloud\BetterReflection\Relocated\PHPStan\Reflection\Annotations;

use TenantCloud\BetterReflection\Relocated\PHPStan\Analyser\Scope;
use TenantCloud\BetterReflection\Relocated\PHPStan\Broker\Broker;
use TenantCloud\BetterReflection\Relocated\PHPStan\Type\VerbosityLevel;
class AnnotationsPropertiesClassReflectionExtensionTest extends \TenantCloud\BetterReflection\Relocated\PHPStan\Testing\TestCase
{
    public function dataProperties() : array
    {
        return [[\TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, ['otherTest' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\OtherNamespace\\Test', 'writable' => \true, 'readable' => \true], 'otherTestReadOnly' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\OtherNamespace\\Ipsum', 'writable' => \false, 'readable' => \true], 'fooOrBar' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\AnnotationsProperties\\Foo', 'writable' => \true, 'readable' => \true], 'conflictingProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\OtherNamespace\\Ipsum', 'writable' => \true, 'readable' => \true], 'interfaceProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\FooInterface::class, 'type' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\FooInterface::class, 'writable' => \true, 'readable' => \true], 'overridenProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'writable' => \true, 'readable' => \true], 'overridenPropertyWithAnnotation' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'writable' => \true, 'readable' => \true]]], [\TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Bar::class, ['otherTest' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\OtherNamespace\\Test', 'writable' => \true, 'readable' => \true], 'otherTestReadOnly' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\OtherNamespace\\Ipsum', 'writable' => \false, 'readable' => \true], 'fooOrBar' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\AnnotationsProperties\\Foo', 'writable' => \true, 'readable' => \true], 'conflictingProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\OtherNamespace\\Ipsum', 'writable' => \true, 'readable' => \true], 'overridenProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Bar::class, 'type' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Bar::class, 'writable' => \true, 'readable' => \true], 'overridenPropertyWithAnnotation' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Bar::class, 'type' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Bar::class, 'writable' => \true, 'readable' => \true], 'conflictingAnnotationProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Bar::class, 'type' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Bar::class, 'writable' => \true, 'readable' => \true]]], [\TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Baz::class, ['otherTest' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\OtherNamespace\\Test', 'writable' => \true, 'readable' => \true], 'otherTestReadOnly' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\OtherNamespace\\Ipsum', 'writable' => \false, 'readable' => \true], 'fooOrBar' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\AnnotationsProperties\\Foo', 'writable' => \true, 'readable' => \true], 'conflictingProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Baz::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\AnnotationsProperties\\Dolor', 'writable' => \true, 'readable' => \true], 'bazProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Baz::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\AnnotationsProperties\\Lorem', 'writable' => \true, 'readable' => \true], 'traitProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Baz::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\AnnotationsProperties\\BazBaz', 'writable' => \true, 'readable' => \true], 'writeOnlyProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Baz::class, 'type' => 'AnnotationsProperties\\Lorem|null', 'writable' => \true, 'readable' => \false]]], [\TenantCloud\BetterReflection\Relocated\AnnotationsProperties\BazBaz::class, ['otherTest' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\OtherNamespace\\Test', 'writable' => \true, 'readable' => \true], 'otherTestReadOnly' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\OtherNamespace\\Ipsum', 'writable' => \false, 'readable' => \true], 'fooOrBar' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Foo::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\AnnotationsProperties\\Foo', 'writable' => \true, 'readable' => \true], 'conflictingProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Baz::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\AnnotationsProperties\\Dolor', 'writable' => \true, 'readable' => \true], 'bazProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Baz::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\AnnotationsProperties\\Lorem', 'writable' => \true, 'readable' => \true], 'traitProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Baz::class, 'type' => 'TenantCloud\\BetterReflection\\Relocated\\AnnotationsProperties\\BazBaz', 'writable' => \true, 'readable' => \true], 'writeOnlyProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Baz::class, 'type' => 'AnnotationsProperties\\Lorem|null', 'writable' => \true, 'readable' => \false], 'numericBazBazProperty' => ['class' => \TenantCloud\BetterReflection\Relocated\AnnotationsProperties\BazBaz::class, 'type' => 'float|int', 'writable' => \true, 'readable' => \true]]]];
    }
    /**
     * @dataProvider dataProperties
     * @param string $className
     * @param array<string, mixed> $properties
     */
    public function testProperties(string $className, array $properties) : void
    {
        /** @var Broker $broker */
        $broker = self::getContainer()->getByType(\TenantCloud\BetterReflection\Relocated\PHPStan\Broker\Broker::class);
        $class = $broker->getClass($className);
        $scope = $this->createMock(\TenantCloud\BetterReflection\Relocated\PHPStan\Analyser\Scope::class);
        $scope->method('isInClass')->willReturn(\true);
        $scope->method('getClassReflection')->willReturn($class);
        $scope->method('canAccessProperty')->willReturn(\true);
        foreach ($properties as $propertyName => $expectedPropertyData) {
            $this->assertTrue($class->hasProperty($propertyName), \sprintf('Class %s does not define property %s.', $className, $propertyName));
            $property = $class->getProperty($propertyName, $scope);
            $this->assertSame($expectedPropertyData['class'], $property->getDeclaringClass()->getName(), \sprintf('Declaring class of property $%s does not match.', $propertyName));
            $this->assertSame($expectedPropertyData['type'], $property->getReadableType()->describe(\TenantCloud\BetterReflection\Relocated\PHPStan\Type\VerbosityLevel::precise()), \sprintf('Type of property %s::$%s does not match.', $property->getDeclaringClass()->getName(), $propertyName));
            $this->assertSame($expectedPropertyData['readable'], $property->isReadable(), \sprintf('Property %s::$%s readability is not as expected.', $property->getDeclaringClass()->getName(), $propertyName));
            $this->assertSame($expectedPropertyData['writable'], $property->isWritable(), \sprintf('Property %s::$%s writability is not as expected.', $property->getDeclaringClass()->getName(), $propertyName));
        }
    }
    public function testOverridingNativePropertiesWithAnnotationsDoesNotBreakGetNativeProperty() : void
    {
        $broker = self::getContainer()->getByType(\TenantCloud\BetterReflection\Relocated\PHPStan\Broker\Broker::class);
        $class = $broker->getClass(\TenantCloud\BetterReflection\Relocated\AnnotationsProperties\Bar::class);
        $this->assertTrue($class->hasNativeProperty('overridenPropertyWithAnnotation'));
        $this->assertSame('TenantCloud\\BetterReflection\\Relocated\\AnnotationsProperties\\Foo', $class->getNativeProperty('overridenPropertyWithAnnotation')->getReadableType()->describe(\TenantCloud\BetterReflection\Relocated\PHPStan\Type\VerbosityLevel::precise()));
    }
}
